-- Full table query
SELECT
	ID,
	TRANSACTION_DATE,
	TRANSACTION_TIME,
	AMOUNT,
	CURRENCY_CODE,
	TRANSACTION_TYPE,
	CATEGORY,
	MERCHANT_CODE,
	MERCHANT_NAME,
	MERCHANT_COUNTRY,
	CARD_TYPE,
	CARD_NUMBER,
	CARD_HOLDER_FIRST_NAME,
	CARD_HOLDER_LAST_NAME,
	CARD_EXPIRY_DATE,
	CARD_ISSUER,
	TRANSACTION_STATUS,
	TRANSACTION_CHANNEL,
	DEVICE_TYPE,
	IP_ADDRESS,
	FRAUD_FLAG,
	CHARGEBACK_FLAG,
	TRANSACTION_REFERENCE,
	CUSTOMER_ID
FROM
	CARD.CARD_TRANSACTION;

-- Update: correct the first letter of the card number to '5' for MasterCard, 
-- and update the card organization name to 'Mastercard'
UPDATE card.card_transaction
SET card_number = '5' || SUBSTRING(card_number FROM 2), card_issuer = 'Mastercard'
WHERE card_issuer = 'MasterCard';


-- Update: correct the first letter of the card number to '4' for Visa
UPDATE card.card_transaction
SET card_number = '4' || SUBSTRING(card_number FROM 2)
WHERE card_issuer = 'Visa';


-- LEFT JOIN - match country code and currecy name 
SELECT
	ID,
	TRANSACTION_DATE,
	TRANSACTION_TIME,
	AMOUNT,
	CURRENCY_CODE,
	C.CURRENCY,
	TRANSACTION_TYPE,
	CATEGORY,
	MERCHANT_CODE,
	MERCHANT_NAME,
	MERCHANT_COUNTRY,
	CARD_TYPE,
	CARD_NUMBER,
	CARD_HOLDER_FIRST_NAME,
	CARD_HOLDER_LAST_NAME,
	CARD_EXPIRY_DATE,
	CARD_ISSUER,
	TRANSACTION_STATUS,
	TRANSACTION_CHANNEL,
	DEVICE_TYPE,
	IP_ADDRESS,
	FRAUD_FLAG,
	CHARGEBACK_FLAG,
	TRANSACTION_REFERENCE,
	CUSTOMER_ID
FROM
	CARD.CARD_TRANSACTION T
	LEFT JOIN CARD.CURRENCY_CODE C ON T.CURRENCY_CODE = C.CODE

-- LEFT JOIN - match countries code and countries name
SELECT
	ID,
	TRANSACTION_DATE,
	TRANSACTION_TIME,
	AMOUNT,
	CURRENCY_CODE,
	TRANSACTION_TYPE,
	CATEGORY,
	MERCHANT_CODE,
	MERCHANT_NAME,
	MERCHANT_COUNTRY,
	C.COUNTRIES,
	CARD_TYPE,
	CARD_NUMBER,
	CARD_HOLDER_FIRST_NAME,
	CARD_HOLDER_LAST_NAME,
	CARD_EXPIRY_DATE,
	CARD_ISSUER,
	TRANSACTION_STATUS,
	TRANSACTION_CHANNEL,
	DEVICE_TYPE,
	IP_ADDRESS,
	FRAUD_FLAG,
	CHARGEBACK_FLAG,
	TRANSACTION_REFERENCE,
	CUSTOMER_ID
FROM
	CARD.CARD_TRANSACTION T
	LEFT JOIN CARD.COUNTRIES C ON T.MERCHANT_COUNTRY = C.CODE


-- JOIN - match currency name and countries name with currency code and currency name
SELECT
	T.ID,
	T.TRANSACTION_DATE,
	T.TRANSACTION_TIME,
	T.AMOUNT,
	CC.CURRENCY,
	T.TRANSACTION_TYPE,
	T.CATEGORY,
	T.MERCHANT_CODE,
	T.MERCHANT_NAME,
	C.COUNTRIES as merchant_country,
	T.CARD_TYPE,
	T.CARD_NUMBER,
	T.CARD_HOLDER_FIRST_NAME,
	T.CARD_HOLDER_LAST_NAME,
	T.CARD_EXPIRY_DATE,
	T.CARD_ISSUER,
	T.TRANSACTION_STATUS,
	T.TRANSACTION_CHANNEL,
	T.DEVICE_TYPE,
	T.IP_ADDRESS,
	T.FRAUD_FLAG,
	T.CHARGEBACK_FLAG,
	T.TRANSACTION_REFERENCE,
	T.CUSTOMER_ID
FROM
	CARD.CARD_TRANSACTION T
	JOIN CARD.COUNTRIES C ON T.MERCHANT_COUNTRY = C.CODE
	JOIN CARD.CURRENCY_CODE CC ON T.CURRENCY_CODE = CC.CODE




