--CREATE DATABASE
CREATE DATABASE CARDS;

-- CREATE SCHEMA CARD
CREATE SCHEMA CARD:

-- CREATE TABLE CARD_TRANSACTION 
CREATE TABLE CARD.CARD_TRANSACTION (
	ID TEXT PRIMARY KEY,
	TRANSACTION_DATE DATE,
	TRANSACTION_TIME TIME,
	AMOUNT NUMERIC(12, 2),
	CURRENCY_CODE CHAR(3),
	TRANSACTION_TYPE TEXT,
	CATEGORY TEXT,
	MERCHANT_CODE CHAR(4),
	MERCHANT_NAME TEXT,
	MERCHANT_COUNTRY CHAR(2),
	CARD_TYPE TEXT,
	CARD_NUMBER CHAR(16),
	CARD_HOLDER_FIRST_NAME TEXT,
	CARD_HOLDER_LAST_NAME TEXT,
	CARD_EXPIRY_DATE TEXT,
	CARD_ISSUER TEXT,
	TRANSACTION_STATUS TEXT,
	TRANSACTION_CHANNEL TEXT,
	DEVICE_TYPE TEXT,
	IP_ADDRESS TEXT,
	FRAUD_FLAG BOOLEAN,
	CHARGEBACK_FLAG BOOLEAN,
	TRANSACTION_REFERENCE TEXT,
	CUSTOMER_ID TEXT
)

-- CREATE TABLE CARD.COUNTRIES
CREATE TABLE CARD.COUNTRIES (
CODE CHAR(2) PRIMARY KEY, 
COUNTRIES TEXT
);

-- INSERT DATA INTO CARD.COUNTRIES
INSERT INTO card.countries (code, countries) VALUES ('US','USA');
INSERT INTO card.countries (code, countries) VALUES ('PL','Poland');
INSERT INTO card.countries (code, countries) VALUES ('DE','Germany');
INSERT INTO card.countries (code, countries) VALUES ('FR','France');
INSERT INTO card.countries (code, countries) VALUES ('UK','United Kingdom');
INSERT INTO card.countries (code, countries) VALUES ('CA','Canada');
INSERT INTO card.countries (code, countries) VALUES ('AU','Australia');
INSERT INTO card.countries (code, countries) VALUES ('JE','Jersey');
INSERT INTO card.countries (code, countries) VALUES ('IT','Italy');
INSERT INTO card.countries (code, countries) VALUES ('ES','Spain');

# CREATE TABLE CARD.CURRENCY_CODE 
CREATE TABLE 
CARD.CURRENCY_CODE (
CODE CHAR(3) PRIMARY KEY, 
CURRENCY TEXT
);

-- INSERT DATA INTO CARD.CURRENCY_CODE 
Insert into card.currency_code (code,currency) values ('985','PLN');
Insert into card.currency_code (code,currency) values ('840','USD');
Insert into card.currency_code (code,currency) values ('978','EUR');
Insert into card.currency_code (code,currency) values ('826','GBP');


-- Create index on importatnt fields in CARD.CARD_TRANSACTION

CREATE INDEX TRANSACTION_DATE ON CARD.CARD_TRANSACTION (TRANSACTION_DATE);
CREATE INDEX TRX_REFERENCE ON CARD.CARD_TRANSACTION (TRANSACTION_REFERENCE);
CREATE INDEX CUSTOMER_ID ON CARD.CARD_TRANSACTION (CUSTOMER_ID NULLS LAST);
CREATE INDEX CARD_EXPIRY_DATE ON CARD.CARD_TRANSACTION (CARD_EXPIRY_DATE ASC);


--Cerate view VI_card_transactions
CREATE OR REPLACE VIEW card.VI_card_transactions AS
SELECT
	T.ID,
	T.TRANSACTION_DATE,
	T.TRANSACTION_TIME,
	T.AMOUNT,
	CC.CURRENCY,
	T.TRANSACTION_TYPE,
	T.CATEGORY,
	T.MERCHANT_CODE,
	T.MERCHANT_NAME,
	C.COUNTRIES as merchant_country,
	T.CARD_TYPE,
	T.CARD_NUMBER,
	T.CARD_HOLDER_FIRST_NAME,
	T.CARD_HOLDER_LAST_NAME,
	T.CARD_EXPIRY_DATE,
	T.CARD_ISSUER,
	T.TRANSACTION_STATUS,
	T.TRANSACTION_CHANNEL,
	T.DEVICE_TYPE,
	T.IP_ADDRESS,
	T.FRAUD_FLAG,
	T.CHARGEBACK_FLAG,
	T.TRANSACTION_REFERENCE,
	T.CUSTOMER_ID
FROM
	CARD.CARD_TRANSACTION T
	JOIN CARD.COUNTRIES C ON T.MERCHANT_COUNTRY = C.CODE
	JOIN CARD.CURRENCY_CODE CC ON T.CURRENCY_CODE = CC.CODE
